import{j as V,r as w,c as h,o as i,w as d,a as t,b as q,e as p,f as m,g as j,n as z,t as l,u as B,D as H,l as v,v as _,F as L,h as M,L as x}from"./app-7bHLq7ZN.js";import{S as c}from"./sweetalert2.all-DEDGJA4x.js";import{_ as R}from"./DialogModal-CcyXWEvs.js";import{_ as D}from"./BodySection-CUvmG5w0.js";import{_ as E}from"./Button-D3L_hWOj.js";import{d as G}from"./index-DcLsLfUg.js";import{u as I,P as F}from"./Permissions-1I2MD7Va.js";import"./Modal-D_uP7QzD.js";import"./SectionTitle-BAYFNwy4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q=t("h3",{class:"text-gray-300"},"Acciones",-1),J={class:"flex flex-col justify-start items-center gap-2 rounded-lg p-4 shadow-md bg-white/10"},K=t("span",{class:"text-white font-bold"}," Genere un folio / Muestre u oculte el folio ",-1),W=t("br",null,null,-1),X={class:"col-span-6"},Y={class:"text-lg font-medium text-gray-900"},Z={key:0},ee={class:"text-sm text-gray-500"},te=t("br",null,null,-1),oe={class:"text-sm text-gray-500"},se=t("br",null,null,-1),ae={class:"text-sm text-gray-500"},ne={class:"col-span-6 sm:col-span-4 hidden"},re={class:"relative flex items-center gap-1"},ie={key:0,class:"mt-2"},le={key:0,class:"col-span-6 mt-4 p-4 rounded-lg bg-white/10 shadow-lg"},ce=t("h4",{class:"text-black font-bold mb-3"}," Actualizar código de Reserva ",-1),ue={class:"flex items-center gap-2"},de=t("span",{class:"text-sm text-gray-500"},"ID:",-1),pe=t("span",{class:"font-bold justify-center flex"},"Actualizar Horarios de Pickup",-1),me={class:"min-w-full divide-y divide-gray-200"},ge=t("thead",null,[t("tr",{class:"bg-gray-100 uppercase text-xs"},[t("th",{class:"px-4 py-2 text-gray-400"},"Parque"),t("th",{class:"px-4 py-2 text-gray-400"},"Hora del pickup"),t("th",{class:"px-4 py-2 text-gray-400"})])],-1),fe=["onUpdate:modelValue"],xe=["onClick"],Be={__name:"CouponQuoteActions",props:{quote:Object,pickupTime:Object},setup(s){const r=s,b=V({coupon:null,error:null,couponCode:null,processing:!1,syncing:!1}),$=async o=>{const e=await x.post(route("coupon.get.coupon",{quote:o}));console.log(e),c.fire({title:"Código de cupón",text:e.data.code,icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},A=async o=>{const e=await x.post(route("coupon.confirm",{coupon:o}));console.log(e),c.fire({title:"Cupon confirmado!",text:"El cupón ha sido confirmado y estara disponible para su uso",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},S=async o=>{c.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, ¡aplicar cupón!"}).then(e=>{e.isConfirmed&&A(o)})},T=o=>{switch(o){case"pending":return"bg-yellow-100 text-yellow-500";case"confirmed":return"bg-green-100 text-green-500";case"canceled":return"bg-red-100 text-red-500";default:return"bg-gray-100 text-gray-500"}},g=w(!1),N=()=>{g.value=!g.value;const o=document.querySelector(".couponUpdate");o&&o.classList.toggle("hidden")},O=async o=>{if(!o)return!1;try{const e=await x.post(route("coupon.update.code",{coupon:o.id}),{code:o.code,coupon_id:o.id});console.log(e),c.fire({title:"Código de cupón actualizado",text:"El código de cupón ha sido actualizado",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})}catch(e){console.error("Error updating coupon:",e);let a="Ha ocurrido un error al actualizar el cupón";e.response&&e.response.data&&e.response.data.errors?a=Object.values(e.response.data.errors).flat().join(", "):e.response&&e.response.data&&e.response.data.message&&(a=e.response.data.message),c.fire({title:"Error",text:a,icon:"error",confirmButtonText:"Ok"})}},f=w(!1),P=()=>{f.value=!0},U=async o=>{try{const e=await x.post(route("quote.listed.activities.update",r.quote.id),{quote_activity_id:o.id,pickup_time:o.pickup_time});e.data.status==="ok"?(c.fire({title:"Éxito",text:"Horarios de pickup actualizado correctamente.",icon:"success"}),G.Inertia.reload()):c.fire({title:"Error",text:e.data.message||"No se pudieron actualizar los horarios.",icon:"error"})}catch(e){console.error("Error updating pickup times:",e),c.fire({title:"Error",text:"Ocurrió un error al actualizar los horarios de pickup.",icon:"error"})}};return(o,e)=>(i(),h(D,null,{title:d(()=>[Q]),description:d(()=>[t("div",J,[K,W,t("button",{class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded",onClick:N},l(g.value?"Ocultar":"Actualizar Codigo de Reserva"),1),t("button",{class:"text-white hover:text-gray-300 font-bold bg-green-600 hover:bg-green-700 active:bg-green-700 px-4 py-2 rounded",onClick:P}," Actualizar Horarios de Pickup ")])]),content:d(()=>{var a,y,C;return[t("div",X,[t("div",Y,[j(" Cotización "),t("span",{class:z([T(r.quote.status),"p-2 rounded"])},"status "+l(r.quote.status),3)]),B(I)(o.$page.props.user,B(F).MANAGE_BRANCH)?(i(),p("div",Z,[t("span",ee,"Realizada por: "+l(r.quote.user.name)+" en ("+l(r.quote.team.name)+") el dia "+l(r.quote.created_at),1),te,t("span",oe,"Precio publico: $"+l(r.quote.public_price),1),se,t("span",ae,"Costo: $"+l(r.quote.cost_amount),1)])):m("",!0)]),t("div",ne,[t("div",re,[(a=s.quote.coupon)!=null&&a.code?m("",!0):(i(),h(E,{key:0,onClick:e[0]||(e[0]=n=>$(r.quote.id)),class:z({"opacity-25":b.processing}),isLoading:b.processing,msg:"Generar Folio"},null,8,["class","isLoading"])),(y=s.quote.coupon)!=null&&y.code&&s.quote.coupon.status!="confirmed"?(i(),h(E,{key:1,onClick:e[1]||(e[1]=n=>S(r.quote.coupon.id)),class:"bg-green-500 hover:bg-green-600",isLoading:b.processing,disabled:s.quote.coupon.confirmation_key==null,msg:"Aceptar cupon"},null,8,["isLoading","disabled"])):m("",!0)]),((C=s.quote.coupon)==null?void 0:C.confirmation_key)==null?(i(),p("small",ie," Nota: debe agregar la clave de confirmación para poder aceptar el cupon. ")):m("",!0)]),q(H,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-4 scale-95","enter-to-class":"opacity-100 transform translate-y-0 scale-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0 scale-100","leave-to-class":"opacity-0 transform -translate-y-4 scale-95"},{default:d(()=>{var n;return[(n=s.quote.coupon)!=null&&n.code&&g.value?(i(),p("div",le,[ce,t("div",ue,[v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=u=>s.quote.coupon.code=u),type:"text",class:"flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Código del cupón"},null,512),[[_,s.quote.coupon.code]]),de,v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=u=>s.quote.coupon.id=u),type:"text",class:"flex-1 p-2 border border-gray-300 rounded bg-gray-100",readonly:""},null,512),[[_,s.quote.coupon.id]]),t("button",{class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded transition-all duration-200 hover:shadow-lg transform hover:scale-105",onClick:e[4]||(e[4]=u=>O(s.quote.coupon))}," Actualizar ")])])):m("",!0)]}),_:1}),q(R,{show:f.value,onClose:e[6]||(e[6]=n=>f.value=!1)},{title:d(()=>[pe]),content:d(()=>[t("table",me,[ge,t("tbody",null,[(i(!0),p(L,null,M(r.quote.listed_activities,n=>{var u;return i(),p("tr",{key:n.id},[t("td",null,l((u=n.activity)==null?void 0:u.name),1),t("td",null,[v(t("input",{"onUpdate:modelValue":k=>n.pickup_time=k,type:"time",class:"w-full"},null,8,fe),[[_,n.pickup_time]])]),t("td",null,[t("button",{class:"bg-blue-900 text-white px-2 py-1 rounded",onClick:k=>U(n)}," Guardar ",8,xe)])])}),128))])])]),footer:d(()=>[t("button",{class:"bg-red-500 text-white px-4 py-2 rounded",onClick:e[5]||(e[5]=n=>f.value=!1)},"Cerrar")]),_:1},8,["show"])]}),_:1}))}};export{Be as default};
