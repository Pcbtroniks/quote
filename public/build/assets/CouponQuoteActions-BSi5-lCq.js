import{j as V,r as A,c as h,o as i,w as u,a as t,b as z,e as d,f as p,g as L,n as B,t as l,u as m,D as j,l as v,v as _,F as R,h as D,L as x}from"./app-DV60zx4p.js";import{S as c}from"./sweetalert2.all-Cb_x15Wz.js";import{_ as G}from"./DialogModal-DkJLduV2.js";import{_ as I}from"./BodySection-CUXyyCzL.js";import{_ as $}from"./Button-CMLByOyz.js";import{d as F}from"./index-DrlXbJZr.js";import{u as k,P as E}from"./Permissions-1I2MD7Va.js";import"./Modal-DbYXrs0O.js";import"./SectionTitle-CG8W3Z1-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q=t("h3",{class:"text-gray-300 text-center sm:text-start"},"Acciones",-1),J={class:"flex flex-col items-center gap-2 rounded-lg p-4 shadow-md bg-white/20"},K=t("span",{class:"text-white font-bold"}," Genere un folio / Muestre u oculte el folio ",-1),W=t("br",null,null,-1),X={class:"col-span-6"},Y={class:"text-lg font-medium text-gray-900"},Z={key:0},ee={class:"text-sm text-gray-500"},te=t("br",null,null,-1),oe={class:"text-sm text-gray-500"},se=t("br",null,null,-1),ae={class:"text-sm text-gray-500"},re={class:"col-span-6 sm:col-span-4"},ne={class:"relative flex items-center gap-1"},ie={key:0,class:"mt-2"},le={key:0,class:"col-span-6 mt-4 p-4 rounded-lg bg-white/10 shadow-lg"},ce=t("h4",{class:"text-black font-bold mb-3"}," Actualizar código de Reserva ",-1),ue={class:"flex items-center gap-2"},de=t("span",{class:"text-sm text-gray-500"},"ID:",-1),pe=t("span",{class:"font-bold justify-center flex"},"Actualizar Horarios de Pickup",-1),me={class:"min-w-full divide-y divide-gray-200"},ge=t("thead",null,[t("tr",{class:"bg-gray-100 uppercase text-xs"},[t("th",{class:"px-4 py-2 text-gray-400"},"Parque"),t("th",{class:"px-4 py-2 text-gray-400"},"Hora del pickup"),t("th",{class:"px-4 py-2 text-gray-400"})])],-1),fe=["onUpdate:modelValue"],xe=["onClick"],ze={__name:"CouponQuoteActions",props:{quote:Object,pickupTime:Object},setup(r){const n=r,b=V({coupon:null,error:null,couponCode:null,processing:!1,syncing:!1}),N=async o=>{const e=await x.post(route("coupon.get.coupon",{quote:o}));console.log(e),c.fire({title:"Código de cupón",text:e.data.code,icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},S=async o=>{const e=await x.post(route("coupon.confirm",{coupon:o}));console.log(e),c.fire({title:"Cupon confirmado!",text:"El cupón ha sido confirmado y estara disponible para su uso",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},T=async o=>{c.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, ¡aplicar cupón!"}).then(e=>{e.isConfirmed&&S(o)})},O=o=>{switch(o){case"pending":return"bg-yellow-100 text-yellow-500";case"confirmed":return"bg-green-100 text-green-500";case"canceled":return"bg-red-100 text-red-500";default:return"bg-gray-100 text-gray-500"}},g=A(!1),P=()=>{g.value=!g.value;const o=document.querySelector(".couponUpdate");o&&o.classList.toggle("hidden")},U=async o=>{if(!o)return!1;try{const e=await x.post(route("coupon.update.code",{coupon:o.id}),{code:o.code,coupon_id:o.id});console.log(e),c.fire({title:"Código de cupón actualizado",text:"El código de cupón ha sido actualizado",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})}catch(e){console.error("Error updating coupon:",e);let a="Ha ocurrido un error al actualizar el cupón";e.response&&e.response.data&&e.response.data.errors?a=Object.values(e.response.data.errors).flat().join(", "):e.response&&e.response.data&&e.response.data.message&&(a=e.response.data.message),c.fire({title:"Error",text:a,icon:"error",confirmButtonText:"Ok"})}},f=A(!1),H=()=>{f.value=!0},M=async o=>{try{const e=await x.post(route("quote.listed.activities.update",n.quote.id),{quote_activity_id:o.id,pickup_time:o.pickup_time});e.data.status==="ok"?(c.fire({title:"Éxito",text:"Horarios de pickup actualizado correctamente.",icon:"success"}),F.Inertia.reload()):c.fire({title:"Error",text:e.data.message||"No se pudieron actualizar los horarios.",icon:"error"})}catch(e){console.error("Error updating pickup times:",e),c.fire({title:"Error",text:"Ocurrió un error al actualizar los horarios de pickup.",icon:"error"})}};return(o,e)=>(i(),h(I,null,{title:u(()=>[Q]),description:u(()=>[t("div",J,[K,W,m(k)(o.$page.props.user,m(E).ADMIN)?(i(),d("button",{key:0,class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded-md mb-4",onClick:P},l(g.value?"Ocultar":"Actualizar Codigo de Reserva"),1)):p("",!0),m(k)(o.$page.props.user,o.MANAGE_BRANCH)?(i(),d("button",{key:1,class:"text-white hover:text-gray-300 font-bold bg-green-600 hover:bg-green-700 active:bg-green-700 px-4 py-2 rounded-md",onClick:H}," Actualizar Horarios de Pickup ")):p("",!0)])]),content:u(()=>{var a,y,C;return[t("div",X,[t("div",Y,[L(" Cotización "),t("span",{class:B([O(n.quote.status),"p-2 rounded"])},"status "+l(n.quote.status),3)]),m(k)(o.$page.props.user,m(E).MANAGE_BRANCH)?(i(),d("div",Z,[t("span",ee,"Realizada por: "+l(n.quote.user.name)+" en ("+l(n.quote.team.name)+") el dia "+l(n.quote.created_at),1),te,t("span",oe,"Precio publico: $"+l(n.quote.public_price),1),se,t("span",ae,"Costo: $"+l(n.quote.cost_amount),1)])):p("",!0)]),t("div",re,[t("div",ne,[(a=r.quote.coupon)!=null&&a.code?p("",!0):(i(),h($,{key:0,onClick:e[0]||(e[0]=s=>N(n.quote.id)),class:B({"opacity-25":b.processing}),isLoading:b.processing,msg:"Generar Folio"},null,8,["class","isLoading"])),(y=r.quote.coupon)!=null&&y.code&&r.quote.coupon.status!="confirmed"?(i(),h($,{key:1,onClick:e[1]||(e[1]=s=>T(n.quote.coupon.id)),class:"bg-green-500 hover:bg-green-600",isLoading:b.processing,disabled:r.quote.coupon.confirmation_key==null,msg:"Aceptar cupon"},null,8,["isLoading","disabled"])):p("",!0)]),((C=r.quote.coupon)==null?void 0:C.confirmation_key)==null?(i(),d("small",ie," Nota: debe agregar la clave de confirmación para poder aceptar el cupon. ")):p("",!0)]),z(j,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-4 scale-95","enter-to-class":"opacity-100 transform translate-y-0 scale-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0 scale-100","leave-to-class":"opacity-0 transform -translate-y-4 scale-95"},{default:u(()=>[g.value?(i(),d("div",le,[ce,t("div",ue,[v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.quote.coupon.code=s),type:"text",class:"flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Código del cupón",maxlength:"16"},null,512),[[_,r.quote.coupon.code]]),de,v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>r.quote.coupon.id=s),type:"text",class:"flex-1 p-2 border border-gray-300 rounded bg-gray-100 selected-none",readonly:""},null,512),[[_,r.quote.coupon.id]]),t("button",{class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded-md transition-all duration-200 hover:shadow-lg transform hover:scale-105",onClick:e[4]||(e[4]=s=>U(r.quote.coupon))}," Actualizar ")])])):p("",!0)]),_:1}),z(G,{show:f.value,onClose:e[6]||(e[6]=s=>f.value=!1)},{title:u(()=>[pe]),content:u(()=>[t("table",me,[ge,t("tbody",null,[(i(!0),d(R,null,D(n.quote.listed_activities,s=>{var w;return i(),d("tr",{key:s.id},[t("td",null,l((w=s.activity)==null?void 0:w.name),1),t("td",null,[v(t("input",{"onUpdate:modelValue":q=>s.pickup_time=q,type:"time",class:"w-full"},null,8,fe),[[_,s.pickup_time]])]),t("td",null,[t("button",{class:"bg-blue-900 text-white px-2 py-1 rounded",onClick:q=>M(s)}," Guardar ",8,xe)])])}),128))])])]),footer:u(()=>[t("button",{class:"bg-red-500 text-white px-4 py-2 rounded",onClick:e[5]||(e[5]=s=>f.value=!1)},"Cerrar")]),_:1},8,["show"])]}),_:1}))}};export{ze as default};
