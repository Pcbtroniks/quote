import{j as V,r as w,c as h,o as i,w as u,a as t,b as q,e as d,f as p,g as H,n as z,t as l,u as B,D as L,l as y,v,F as j,h as M,L as f}from"./app-Bnk-1-bh.js";import{S as c}from"./sweetalert2.all-CjuIP0oy.js";import{_ as R}from"./DialogModal-B40IZ176.js";import{_ as D}from"./BodySection-CfB5vvGE.js";import{_ as E}from"./Button-DwMAGUs1.js";import{d as G}from"./index-CeZDBE-b.js";import{u as I,P as F}from"./Permissions-1I2MD7Va.js";import"./Modal-n16Hd1V4.js";import"./SectionTitle-DFDvoTve.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q=t("h3",{class:"text-gray-300 text-center sm:text-start"},"Acciones",-1),J={class:"flex flex-col items-center gap-2 rounded-lg p-4 shadow-md bg-white/20"},K=t("span",{class:"text-white font-bold"}," Genere un folio / Muestre u oculte el folio ",-1),W=t("br",null,null,-1),X={class:"col-span-6"},Y={class:"text-lg font-medium text-gray-900"},Z={key:0},ee={class:"text-sm text-gray-500"},te=t("br",null,null,-1),oe={class:"text-sm text-gray-500"},se=t("br",null,null,-1),ae={class:"text-sm text-gray-500"},ne={class:"col-span-6 sm:col-span-4 hidden"},re={class:"relative flex items-center gap-1"},ie={key:0,class:"mt-2"},le={key:0,class:"col-span-6 mt-4 p-4 rounded-lg bg-white/10 shadow-lg"},ce=t("h4",{class:"text-black font-bold mb-3"}," Actualizar código de Reserva ",-1),ue={class:"flex items-center gap-2"},de=t("span",{class:"text-sm text-gray-500"},"ID:",-1),pe=t("span",{class:"font-bold justify-center flex"},"Actualizar Horarios de Pickup",-1),me={class:"min-w-full divide-y divide-gray-200"},ge=t("thead",null,[t("tr",{class:"bg-gray-100 uppercase text-xs"},[t("th",{class:"px-4 py-2 text-gray-400"},"Parque"),t("th",{class:"px-4 py-2 text-gray-400"},"Hora del pickup"),t("th",{class:"px-4 py-2 text-gray-400"})])],-1),fe=["onUpdate:modelValue"],xe=["onClick"],Be={__name:"CouponQuoteActions",props:{quote:Object,pickupTime:Object},setup(n){const r=n,x=V({coupon:null,error:null,couponCode:null,processing:!1,syncing:!1}),$=async o=>{const e=await f.post(route("coupon.get.coupon",{quote:o}));console.log(e),c.fire({title:"Código de cupón",text:e.data.code,icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},A=async o=>{const e=await f.post(route("coupon.confirm",{coupon:o}));console.log(e),c.fire({title:"Cupon confirmado!",text:"El cupón ha sido confirmado y estara disponible para su uso",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},S=async o=>{c.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, ¡aplicar cupón!"}).then(e=>{e.isConfirmed&&A(o)})},T=o=>{switch(o){case"pending":return"bg-yellow-100 text-yellow-500";case"confirmed":return"bg-green-100 text-green-500";case"canceled":return"bg-red-100 text-red-500";default:return"bg-gray-100 text-gray-500"}},m=w(!1),N=()=>{m.value=!m.value;const o=document.querySelector(".couponUpdate");o&&o.classList.toggle("hidden")},O=async o=>{if(!o)return!1;try{const e=await f.post(route("coupon.update.code",{coupon:o.id}),{code:o.code,coupon_id:o.id});console.log(e),c.fire({title:"Código de cupón actualizado",text:"El código de cupón ha sido actualizado",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})}catch(e){console.error("Error updating coupon:",e);let a="Ha ocurrido un error al actualizar el cupón";e.response&&e.response.data&&e.response.data.errors?a=Object.values(e.response.data.errors).flat().join(", "):e.response&&e.response.data&&e.response.data.message&&(a=e.response.data.message),c.fire({title:"Error",text:a,icon:"error",confirmButtonText:"Ok"})}},g=w(!1),P=()=>{g.value=!0},U=async o=>{try{const e=await f.post(route("quote.listed.activities.update",r.quote.id),{quote_activity_id:o.id,pickup_time:o.pickup_time});e.data.status==="ok"?(c.fire({title:"Éxito",text:"Horarios de pickup actualizado correctamente.",icon:"success"}),G.Inertia.reload()):c.fire({title:"Error",text:e.data.message||"No se pudieron actualizar los horarios.",icon:"error"})}catch(e){console.error("Error updating pickup times:",e),c.fire({title:"Error",text:"Ocurrió un error al actualizar los horarios de pickup.",icon:"error"})}};return(o,e)=>(i(),h(D,null,{title:u(()=>[Q]),description:u(()=>[t("div",J,[K,W,t("button",{class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded-md mb-4",onClick:N},l(m.value?"Ocultar":"Actualizar Codigo de Reserva"),1),t("button",{class:"text-white hover:text-gray-300 font-bold bg-green-600 hover:bg-green-700 active:bg-green-700 px-4 py-2 rounded-md",onClick:P}," Actualizar Horarios de Pickup ")])]),content:u(()=>{var a,b,_;return[t("div",X,[t("div",Y,[H(" Cotización "),t("span",{class:z([T(r.quote.status),"p-2 rounded"])},"status "+l(r.quote.status),3)]),B(I)(o.$page.props.user,B(F).MANAGE_BRANCH)?(i(),d("div",Z,[t("span",ee,"Realizada por: "+l(r.quote.user.name)+" en ("+l(r.quote.team.name)+") el dia "+l(r.quote.created_at),1),te,t("span",oe,"Precio publico: $"+l(r.quote.public_price),1),se,t("span",ae,"Costo: $"+l(r.quote.cost_amount),1)])):p("",!0)]),t("div",ne,[t("div",re,[(a=n.quote.coupon)!=null&&a.code?p("",!0):(i(),h(E,{key:0,onClick:e[0]||(e[0]=s=>$(r.quote.id)),class:z({"opacity-25":x.processing}),isLoading:x.processing,msg:"Generar Folio"},null,8,["class","isLoading"])),(b=n.quote.coupon)!=null&&b.code&&n.quote.coupon.status!="confirmed"?(i(),h(E,{key:1,onClick:e[1]||(e[1]=s=>S(r.quote.coupon.id)),class:"bg-green-500 hover:bg-green-600",isLoading:x.processing,disabled:n.quote.coupon.confirmation_key==null,msg:"Aceptar cupon"},null,8,["isLoading","disabled"])):p("",!0)]),((_=n.quote.coupon)==null?void 0:_.confirmation_key)==null?(i(),d("small",ie," Nota: debe agregar la clave de confirmación para poder aceptar el cupon. ")):p("",!0)]),q(L,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-4 scale-95","enter-to-class":"opacity-100 transform translate-y-0 scale-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0 scale-100","leave-to-class":"opacity-0 transform -translate-y-4 scale-95"},{default:u(()=>[m.value?(i(),d("div",le,[ce,t("div",ue,[y(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.quote.coupon.code=s),type:"text",class:"flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Código del cupón",maxlength:"16"},null,512),[[v,n.quote.coupon.code]]),de,y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.quote.coupon.id=s),type:"text",class:"flex-1 p-2 border border-gray-300 rounded bg-gray-100 selected-none",readonly:""},null,512),[[v,n.quote.coupon.id]]),t("button",{class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded-md transition-all duration-200 hover:shadow-lg transform hover:scale-105",onClick:e[4]||(e[4]=s=>O(n.quote.coupon))}," Actualizar ")])])):p("",!0)]),_:1}),q(R,{show:g.value,onClose:e[6]||(e[6]=s=>g.value=!1)},{title:u(()=>[pe]),content:u(()=>[t("table",me,[ge,t("tbody",null,[(i(!0),d(j,null,M(r.quote.listed_activities,s=>{var C;return i(),d("tr",{key:s.id},[t("td",null,l((C=s.activity)==null?void 0:C.name),1),t("td",null,[y(t("input",{"onUpdate:modelValue":k=>s.pickup_time=k,type:"time",class:"w-full"},null,8,fe),[[v,s.pickup_time]])]),t("td",null,[t("button",{class:"bg-blue-900 text-white px-2 py-1 rounded",onClick:k=>U(s)}," Guardar ",8,xe)])])}),128))])])]),footer:u(()=>[t("button",{class:"bg-red-500 text-white px-4 py-2 rounded",onClick:e[5]||(e[5]=s=>g.value=!1)},"Cerrar")]),_:1},8,["show"])]}),_:1}))}};export{Be as default};
