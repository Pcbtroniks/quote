import{j as E,r as O,c as b,o as i,w as g,a as o,b as T,e as x,f as c,g as $,n as v,t as r,u as C,D as L,l as _,v as q,L as y}from"./app-CakD0I0F.js";import{S as l}from"./sweetalert2.all-aGxI4iXy.js";import{_ as U}from"./BodySection-D0aDeH3L.js";import{_ as w}from"./Button-P3OyeESd.js";import"./index-BjWp-Esz.js";import{u as V,P as j}from"./Permissions-1I2MD7Va.js";import"./SectionTitle-CR2o7fHP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M=o("h3",{class:"text-gray-300"},"Acciones",-1),R={class:"flex flex-col justify-start items-center gap-2 rounded-lg p-4 shadow-md bg-white/10"},D=o("span",{class:"text-white font-bold"}," Genere un folio / Muestre u oculte el folio ",-1),P=o("br",null,null,-1),G={class:"col-span-6"},H={class:"text-lg font-medium text-gray-900"},I={key:0},F={class:"text-sm text-gray-500"},Q=o("br",null,null,-1),J={class:"text-sm text-gray-500"},K=o("br",null,null,-1),W={class:"text-sm text-gray-500"},X={class:"col-span-6 sm:col-span-4 hidden"},Y={class:"relative flex items-center gap-1"},Z={key:0,class:"mt-2"},ee={key:0,class:"col-span-6 mt-4 p-4 rounded-lg bg-white/10 shadow-lg"},oe=o("h4",{class:"text-black font-bold mb-3"}," Actualizar código de Reserva ",-1),te={class:"flex items-center gap-2"},se=o("span",{class:"text-sm text-gray-500"},"ID:",-1),pe={__name:"CouponQuoteActions",props:{quote:Object},setup(s){const n=s,m=E({coupon:null,error:null,couponCode:null,processing:!1,syncing:!1}),k=async t=>{const e=await y.post(route("coupon.get.coupon",{quote:t}));console.log(e),l.fire({title:"Código de cupón",text:e.data.code,icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},B=async t=>{const e=await y.post(route("coupon.confirm",{coupon:t}));console.log(e),l.fire({title:"Cupon confirmado!",text:"El cupón ha sido confirmado y estara disponible para su uso",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})},S=async t=>{l.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, ¡aplicar cupón!"}).then(e=>{e.isConfirmed&&B(t)})},z=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-500";case"confirmed":return"bg-green-100 text-green-500";case"canceled":return"bg-red-100 text-red-500";default:return"bg-gray-100 text-gray-500"}},u=O(!1),A=()=>{u.value=!u.value;const t=document.querySelector(".couponUpdate");t&&t.classList.toggle("hidden")},N=async t=>{if(!t)return!1;try{const e=await y.post(route("coupon.update.code",{coupon:t.id}),{code:t.code,coupon_id:t.id});console.log(e),l.fire({title:"Código de cupón actualizado",text:"El código de cupón ha sido actualizado",icon:"success",confirmButtonText:"Ok"}).then(a=>{a.isConfirmed&&location.reload()})}catch(e){console.error("Error updating coupon:",e);let a="Ha ocurrido un error al actualizar el cupón";e.response&&e.response.data&&e.response.data.errors?a=Object.values(e.response.data.errors).flat().join(", "):e.response&&e.response.data&&e.response.data.message&&(a=e.response.data.message),l.fire({title:"Error",text:a,icon:"error",confirmButtonText:"Ok"})}};return(t,e)=>(i(),b(U,null,{title:g(()=>[M]),description:g(()=>[o("div",R,[D,P,o("button",{class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded",onClick:A},r(u.value?"Ocultar":"Actualizar Codigo de Reserva"),1)])]),content:g(()=>{var a,f,h;return[o("div",G,[o("div",H,[$(" Cotización "),o("span",{class:v([z(n.quote.status),"p-2 rounded"])},"status "+r(n.quote.status),3)]),C(V)(t.$page.props.user,C(j).MANAGE_BRANCH)?(i(),x("div",I,[o("span",F,"Realizada por: "+r(n.quote.user.name)+" en ("+r(n.quote.team.name)+") el dia "+r(n.quote.created_at),1),Q,o("span",J,"Precio publico: $"+r(n.quote.public_price),1),K,o("span",W,"Costo: $"+r(n.quote.cost_amount),1)])):c("",!0)]),o("div",X,[o("div",Y,[(a=s.quote.coupon)!=null&&a.code?c("",!0):(i(),b(w,{key:0,onClick:e[0]||(e[0]=d=>k(n.quote.id)),class:v({"opacity-25":m.processing}),isLoading:m.processing,msg:"Generar Folio"},null,8,["class","isLoading"])),(f=s.quote.coupon)!=null&&f.code&&s.quote.coupon.status!="confirmed"?(i(),b(w,{key:1,onClick:e[1]||(e[1]=d=>S(n.quote.coupon.id)),class:"bg-green-500 hover:bg-green-600",isLoading:m.processing,disabled:s.quote.coupon.confirmation_key==null,msg:"Aceptar cupon"},null,8,["isLoading","disabled"])):c("",!0)]),((h=s.quote.coupon)==null?void 0:h.confirmation_key)==null?(i(),x("small",Z," Nota: debe agregar la clave de confirmación para poder aceptar el cupon. ")):c("",!0)]),T(L,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-4 scale-95","enter-to-class":"opacity-100 transform translate-y-0 scale-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0 scale-100","leave-to-class":"opacity-0 transform -translate-y-4 scale-95"},{default:g(()=>{var d;return[(d=s.quote.coupon)!=null&&d.code&&u.value?(i(),x("div",ee,[oe,o("div",te,[_(o("input",{"onUpdate:modelValue":e[2]||(e[2]=p=>s.quote.coupon.code=p),type:"text",class:"flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Código del cupón",maxlength:"16"},null,512),[[q,s.quote.coupon.code]]),se,_(o("input",{"onUpdate:modelValue":e[3]||(e[3]=p=>s.quote.coupon.id=p),type:"text",class:"flex-1 p-2 border border-gray-300 rounded bg-gray-100",readonly:""},null,512),[[q,s.quote.coupon.id]]),o("button",{class:"text-white hover:text-gray-300 font-bold bg-blue-900 hover:bg-mainblue active:bg-mainblue px-4 py-2 rounded transition-all duration-200 hover:shadow-lg transform hover:scale-105",onClick:e[4]||(e[4]=p=>N(s.quote.coupon))}," Actualizar ")])])):c("",!0)]}),_:1})]}),_:1}))}};export{pe as default};
