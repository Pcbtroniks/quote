import{I as w,o as a,c as d,w as l,f as m,a as s,t as c,b as r,J as k,d as u,n as C,e as g,K as y}from"./app.925ffcad.js";import{_ as $}from"./BodySection.0b4aac8c.js";import{_ as q,a as S}from"./TextInput.cc6312c5.js";import{_ as L}from"./InputLabel.bc2cfd1a.js";import{_ as p}from"./Button.f97913a8.js";import"./SectionTitle.938fb9e4.js";import"./_plugin-vue_export-helper.cdc0426e.js";const V={class:"col-span-6"},j={class:"col-span-6 sm:col-span-4"},B={class:"relative flex items-center gap-1"},N=s("div",null,null,-1),z={class:"absolute hidden xl:block xl:left-2/3"},H={version:"1.1",class:"h-4 text-dark",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 52.966 52.966",style:{"enable-background":"new 0 0 52.966 52.966"},"xml:space":"preserve"},I=s("path",{d:`M51.704,51.273L36.845,35.82c3.79-3.801,6.138-9.041,6.138-14.82c0-11.58-9.42-21-21-21s-21,9.42-21,21s9.42,21,21,21\r
                        c5.083,0,9.748-1.817,13.384-4.832l14.895,15.491c0.196,0.205,0.458,0.307,0.721,0.307c0.25,0,0.499-0.093,0.693-0.279\r
                        C52.074,52.304,52.086,51.671,51.704,51.273z M21.983,40c-10.477,0-19-8.523-19-19s8.523-19,19-19s19,8.523,19,19\r
                        S32.459,40,21.983,40z`},null,-1),K=[I],T={key:0},A={class:"mt-4 xl:w-[31rem] border-2 border-b-4 border-gray-200 rounded-xl hover:bg-gray-50"},D={key:0,class:"bg-sky-500 w-fit px-4 py-1 text-sm font-bold text-white rounded-tl-lg rounded-br-xl"},E={class:"grid grid-cols-6 p-5 gap-y-2"},M={class:"col-span-5 md:col-span-4 ml-4"},R=["href"],G={class:"text-sky-500 font-bold text-xs capitalize"},J={class:"text-gray-600 font-bold"},O={class:"text-gray-400"},P={class:"text-gray-400"},U={class:"col-span-6 xl:col-auto flex xl:flex-col justify-between"},F={class:"flex col-start-2 ml-4 md:col-start-auto md:ml-0 md:justify-end"},Q={class:"rounded-lg text-sky-500 font-bold bg-sky-100 py-1 px-3 text-sm w-fit h-fit"},no={__name:"SyncInvoiceCoupon",props:{invoice:Object},setup(f){const i=f,o=w({coupon:null,error:null,couponCode:null,processing:!1,syncing:!1}),v=()=>null,_=async n=>{if(!n)return!1;o.coupon=null,o.processing=!0;const e=await b(route("coupon.search.code",{code:n}));e.status==404?(o.processing=!1,o.error="No se ha encontrado un cupon",setTimeout(()=>{o.error=null},3e3)):(o.processing=!1,o.coupon=e,console.log(e))},h=async(n,e)=>{if(!e)return!1;o.syncing=!0;try{const t=await y.post(route("invoices.sync.coupon",{invoice:n}),{coupon:e});o.coupon.invoice_id=n}catch(t){alert("Ha ocurrido un error: "+t.message)}finally{o.syncing=!1}},x=async(n,e)=>{if(!e)return!1;o.syncing=!0;try{const t=await y.post(route("invoices.unsync.coupon",{invoice:n}),{coupon:e});o.coupon.invoice_id=null,console.log(t)}catch(t){alert("Ha ocurrido un error: "+t.message)}finally{o.syncing=!1}},b=async(n,e)=>{try{return await(await fetch(n,e)).json()}catch(t){console.error(await t.json())}};return(n,e)=>(a(),d($,{onSubmitted:v},{title:l(()=>[m(" Invoice Details ")]),description:l(()=>[m(" Sync invoice with coupons searching by coupon code. ")]),content:l(()=>[s("div",V,[s("div",null,c(`Invoice folio: ${i.invoice.folio} - status: ${i.invoice.status}`),1)]),s("div",j,[r(L,{for:"folio",value:"Search a coupon"}),s("div",B,[r(q,{onKeyup:e[0]||(e[0]=k(t=>_(o.couponCode),["enter"])),id:"folio",modelValue:o.couponCode,"onUpdate:modelValue":e[1]||(e[1]=t=>o.couponCode=t),type:"text",class:"inline w-3/4",placeholder:"Search by code...",autofocus:""},null,8,["modelValue"]),N,s("div",z,[(a(),u("svg",H,K))]),r(p,{onClick:e[2]||(e[2]=t=>_(o.couponCode)),class:C({"opacity-25":o.processing}),disabled:!o.couponCode,isLoading:o.processing,msg:"SEARCH"},null,8,["class","disabled","isLoading"])]),r(S,{message:o.error,class:"mt-2"},null,8,["message"]),o.coupon?(a(),u("div",T,[s("div",A,[o.coupon.quote.national!=0?(a(),u("p",D," Promomex ")):g("",!0),s("div",E,[s("div",M,[s("a",{target:"_blank",href:o.coupon.quote.url},[s("p",G,c(o.coupon.quote.team.name)+" "+c(o.coupon.quote.type)+c(o.coupon.quote.type=="paquete"?"#"+o.coupon.quote.listed_activities.length:""),1)],8,R),s("p",J,c(o.coupon.quote.listed_activity.activity.name),1),s("p",O,c(o.coupon.quote.listed_activity.date),1),s("p",P,c(o.coupon.quote.holder_name),1)]),s("div",U,[s("div",F,[s("p",Q,"$"+c(o.coupon.sale_amount),1)]),s("div",null,[o.coupon.invoice_id?(a(),d(p,{key:1,onClick:e[4]||(e[4]=t=>x(i.invoice.id,o.coupon.id)),isLoading:o.syncing,class:"bg-red-500 hover:bg-red-700",msg:"Remover"},null,8,["isLoading"])):(a(),d(p,{key:0,onClick:e[3]||(e[3]=t=>h(i.invoice.id,o.coupon.id)),isLoading:o.syncing,msg:"Agregar"},null,8,["isLoading"]))])])])])])):g("",!0)])]),actions:l(()=>[]),_:1}))}};export{no as default};
